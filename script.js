// simple multi-lang + auth + dynamic links
const i18n = { en:{title:"Italy Visa Dashboard",login:"Login",hint:"Use user1..user10 with passwords pass1..pass10 for demo",brand:"Italy Humanitarian Visa",mainMenu:"Main Menu",welcome:"Welcome",welcomeDesc:"Select an item from the sidebar to get started.",account:"Account",logout:"Logout"}, fa:{title:"داشبورد ویزای ایتالیا",login:"ورود",hint:"برای تست از user1..user10 با گذرواژه pass1..pass10 استفاده کنید",brand:"داشبورد مهاجرتی ویزای ایتالیا",mainMenu:"منوی اصلی",welcome:"خوش آمدید",welcomeDesc:"برای شروع یک گزینه از سایدبار انتخاب کنید.",account:"حساب کاربری",logout:"خروج"}};
function setLang(lang){document.documentElement.lang=(lang==='fa')?'fa':'en';document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');if(i18n[lang]&&i18n[lang][k])el.innerText=i18n[lang][k];});document.documentElement.dir=(lang==='fa')?'rtl':'ltr';const sb=document.querySelector('.sidebar');if(sb)sb.style.direction=document.documentElement.dir}
const loginBtn=document.getElementById('loginBtn');if(loginBtn){setLang(localStorage.getItem('appLang')||'en');document.getElementById('langEn').addEventListener('click',()=>{localStorage.setItem('appLang','en');setLang('en')});document.getElementById('langFa').addEventListener('click',()=>{localStorage.setItem('appLang','fa');setLang('fa')});loginBtn.addEventListener('click',()=>{const u=document.getElementById('username').value.trim();const p=document.getElementById('password').value.trim();const err=document.getElementById('errorMsg');if(!u||!p){err.innerText='Please enter username and password';return;}fetch('data.json').then(r=>r.json()).then(d=>{const user=d.users.find(x=>x.username===u&&x.password===p);if(user){localStorage.setItem('loggedUser',JSON.stringify({id:user.id,username:user.username}));sessionStorage.setItem('userLinks',JSON.stringify(user.links));window.location.href='dashboard.html';}else{err.innerText='Invalid username or password'}}).catch(e=>{err.innerText='Failed to load user data';console.error(e)})})}
if(window.location.pathname.endsWith('dashboard.html')||window.location.pathname.endsWith('/')){setLang(localStorage.getItem('appLang')||'en');document.getElementById('toggleLang').addEventListener('click',()=>{const c=localStorage.getItem('appLang')||'en';const n=(c==='en')?'fa':'en';localStorage.setItem('appLang',n);setLang(n)});const logged=JSON.parse(localStorage.getItem('loggedUser')||'null');const links=JSON.parse(sessionStorage.getItem('userLinks')||'null');if(!logged||!links){window.location.href='index.html'}else{document.getElementById('userWelcome').innerText=logged.username;const mapping={dashboard:links.dashboard,complete:links.applicationForm.complete,passport:links.applicationForm.passport,photo:links.applicationForm.photo,idDocs:links.applicationForm.idDocs,unhcr:links.supportingEvidence.unhcr,danger:links.supportingEvidence.danger,residency:links.supportingEvidence.residency,education:links.supportingEvidence.education,appointment:links.interviewManagement.appointment,payment:links.interviewManagement.payment,fingerprint:links.interviewManagement.fingerprint,status:links.interviewManagement.status,checklist:links.finalDecision.checklist,guide:links.finalDecision.guide,result:links.finalDecision.result,visaLetter:links.finalDecision.visaLetter,initialRequests:links.unhcrSection.initialRequests,initialReceipts:links.unhcrSection.initialReceipts,requiredDocs:links.unhcrSection.requiredDocs,finalResult:links.unhcrSection.finalResult,total:links.paymentFeeSection.total,interviewFee:links.paymentFeeSection.interviewFee,visaFee:links.paymentFeeSection.visaFee,receipt:links.paymentFeeSection.receipt,refund:links.supportSection.refund,email:links.supportSection.email,telegram:links.supportSection.telegram,overview:links.account.overview,message:links.account.message,settings:links.account.settings,logout:links.account.logout};document.querySelectorAll('[data-key]').forEach(a=>{const k=a.getAttribute('data-key');if(mapping[k]){a.setAttribute('href',mapping[k]);if(mapping[k].endsWith('.pdf'))a.setAttribute('target','_blank')}else a.setAttribute('href','#')});document.getElementById('logoutLink').addEventListener('click',e=>{e.preventDefault();localStorage.removeItem('loggedUser');sessionStorage.removeItem('userLinks');window.location.href='index.html'})}}
